# ğŸš€ Prompt de Transition - Chat 9 â†’ Chat 10 (Session 11)

**Copiez ce prompt dans le nouveau chat (Chat 10) pour continuitÃ© parfaite**

---

Bonjour ! Je reprends le dÃ©veloppement de **Desktop-Mate** aprÃ¨s le **Chat 9 (Bugfixes & Optimisations GPU)**.

## ğŸ“‹ Contexte du Projet

**Desktop-Mate** est une application hybride **Unity + Python** qui affiche un avatar VRM interactif sur le bureau Windows avec IA conversationnelle (Kira utilisant LLM Zephyr-7B).

**Version actuelle** : v0.12.0-alpha  
**Date** : 27 octobre 2025

## âœ… Chat 9 - Accomplissements

Le Chat 9 a rÃ©solu **6 bugs critiques** et ajoutÃ© **5 features UX** :

### Bugs RÃ©solus
1. âœ… **Chat input bloquÃ©** â†’ Signal Qt `chat_input_ready` (thread-safe)
2. âœ… **Ã‰motions Discord non sync GUI** â†’ Signal `emotion_detected` + shared UnityBridge
3. âœ… **GUI sliders non mis Ã  jour** â†’ Signal `expression_changed`
4. âœ… **LLM sur RAM au lieu de GPU** â†’ Profil "performance" + CUDA recompilÃ©
5. âœ… **Compteur messages DB total** â†’ Compteur session local
6. âœ… **Oubli activation venv** â†’ Documentation systÃ¨me critique

### Features AjoutÃ©es
1. âœ… Indicateur "âœï¸ Kira Ã©crit..." pendant gÃ©nÃ©ration
2. âœ… Compteur messages session actuelle (pas DB total)
3. âœ… Menu Options restructurÃ© (sous-menus IA/Discord)
4. âœ… Compteur Ã©motions supprimÃ© (simplification UX)
5. âœ… Documentation venv critique (.github/instructions/)

### MÃ©triques Performance
- âš¡ **Vitesse LLM** : 2-5 tok/s â†’ **25-35 tok/s** (5-7x plus rapide)
- ğŸ’¾ **VRAM** : 0 GB (RAM) â†’ **5.4 GB** (GPU activÃ©)
- ğŸ® **GPU layers** : 35/43 â†’ **43/43** (100%)
- ğŸ“ **Context** : 2048 â†’ **4096** tokens (doublÃ©)

### Fichiers ModifiÃ©s
- `src/gui/app.py` (~100 lignes)
- `src/discord_bot/bot.py` (~15 lignes)
- `src/ai/config.py` (1 ligne)
- `data/config.json` (1 ligne)
- `.github/instructions/copilot-instructions.instructions.md` (~10 lignes)

## ğŸ¯ Session 11 - Performance Optimizations

Je veux maintenant dÃ©marrer la **Session 11** pour optimiser les performances sur **4 axes** :

### Phase 1 : Memory Profiling (1-2h)
- Installer `memory-profiler`, `psutil`
- CrÃ©er `scripts/profile_memory.py`
- Mesurer baseline RAM/VRAM (dÃ©marrage, aprÃ¨s LLM, aprÃ¨s 10/50/100 messages)
- Identifier fuites mÃ©moire potentielles
- Documenter : `docs/sessions/session_11_performance/MEMORY_PROFILING.md`

### Phase 2 : LLM Cache Optimization (1-2h)
- Analyser paramÃ¨tres `n_ctx`, `n_batch`, `use_mlock`
- Tester prÃ©chargement cache (warming)
- Benchmarker latences (cold vs warm cache)
- Optimiser premiÃ¨re gÃ©nÃ©ration
- Documenter : `docs/sessions/session_11_performance/LLM_CACHE_OPTIMIZATION.md`

### Phase 3 : Unity IPC Overhead (1-2h)
- Mesurer latence IPC actuelle (`set_expression()`, `load_model()`)
- Identifier goulots : JSON sÃ©rialisation, TCP overhead, Queue Unity
- Tester : batching commandes, compression, Protocol Buffers
- ImplÃ©menter optimisations validÃ©es
- Documenter : `docs/sessions/session_11_performance/IPC_OPTIMIZATION.md`

### Phase 4 : CPU Optimization (1h)
- Auto-dÃ©tecter CPU (cÅ“urs physiques/logiques)
- Benchmarker `n_threads` (4, 6, 8, 10)
- ImplÃ©menter auto-dÃ©tection optimale
- Documenter : `docs/sessions/session_11_performance/CPU_OPTIMIZATION.md`

### Phase 5 : GPU Profiling & Tuning (2h)
- Monitoring GPU continu (`scripts/monitor_gpu.py`)
- Mesurer : GPU %, VRAM, temperature, power
- Benchmarker 3 profils (performance, balanced, cpu_fallback)
- CrÃ©er profil dynamique (ajuste `n_gpu_layers` auto)
- Documenter : `docs/sessions/session_11_performance/GPU_PROFILING.md`

### Phase 6 : Tests & Documentation (1h)
- Tests unitaires (270+ doivent passer)
- Benchmarks comparatifs avant/aprÃ¨s
- Documentation Session 11 complÃ¨te
- Scripts profiling archivÃ©s dans `docs/sessions/session_11_performance/scripts/`

## ğŸ“Š Baseline Ã  Mesurer

**LLM** : 25-35 tok/s, latence premiÃ¨re gÃ©nÃ©ration ?, latence suivante ?  
**MÃ©moire** : RAM dÃ©marrage ?, RAM aprÃ¨s LLM ?, VRAM 5.4 GB  
**CPU** : 6 threads fixe, usage % pendant gÃ©nÃ©ration ?  
**GPU** : 43/43 layers, usage %, temperature ?, power ?  
**IPC** : Latence `set_expression()` ?, `load_model()` ?, throughput ?

## ğŸ› ï¸ Outils Ã  Installer

```powershell
# Activer venv TOUJOURS
venv\Scripts\Activate.ps1

# Installer outils profiling
pip install memory-profiler psutil pytest-benchmark
```

## ğŸ“ Structure Attendue

```
docs/sessions/session_11_performance/
â”œâ”€â”€ README.md (vue d'ensemble)
â”œâ”€â”€ MEMORY_PROFILING.md
â”œâ”€â”€ LLM_CACHE_OPTIMIZATION.md
â”œâ”€â”€ IPC_OPTIMIZATION.md
â”œâ”€â”€ CPU_OPTIMIZATION.md
â”œâ”€â”€ GPU_PROFILING.md
â””â”€â”€ scripts/
    â”œâ”€â”€ profile_memory.py
    â”œâ”€â”€ monitor_gpu.py
    â”œâ”€â”€ benchmark_llm.py
    â””â”€â”€ benchmark_ipc.py
```

## âš ï¸ Points d'Attention

1. **Ne pas rÃ©gresser** : 270 tests doivent passer, vitesse â‰¥ 25-35 tok/s
2. **Mesures scientifiques** : Baseline AVANT, comparaison APRÃˆS, moyenne 5-10 runs
3. **Documentation systÃ©matique** : Chaque optimisation documentÃ©e avec benchmarks
4. **RÃ¨gle venv** : TOUJOURS activer `venv\Scripts\Activate.ps1` AVANT commandes Python

## ğŸ“– Documentation Disponible

Consulter ces fichiers pour contexte complet :
- `docs/chat_transitions/chat_9_bugfixes_gpu/README.md` - DÃ©tails Chat 9
- `docs/chat_transitions/chat_9_bugfixes_gpu/CURRENT_STATE.md` - Ã‰tat actuel projet
- `docs/chat_transitions/chat_9_bugfixes_gpu/CONTEXT_FOR_NEXT_CHAT.md` - Plan dÃ©taillÃ© Session 11
- `README.md` - Documentation principale projet
- `docs/INDEX.md` - Index complet documentation
- `.github/instructions/copilot-instructions.instructions.md` - Instructions systÃ¨me

## ğŸ¯ Objectifs Session 11

**Minimaux** :
- âœ… Baseline mÃ©triques documentÃ©e
- âœ… CPU `n_threads` auto-dÃ©tectÃ©
- âœ… GPU profiling complet

**Optimaux** :
- âœ… RAM usage -10-20%
- âœ… Latence premiÃ¨re gÃ©nÃ©ration -20-30%
- âœ… IPC latence -20-30%

**Stretch** :
- âœ… Profil GPU dynamique
- âœ… Suite profiling rÃ©utilisable
- âœ… Guide performance utilisateur

## ğŸš€ Prochaine Ã‰tape ImmÃ©diate

1. CrÃ©er dossier `docs/sessions/session_11_performance/`
2. Installer outils profiling
3. CrÃ©er `scripts/profile_memory.py`
4. Mesurer baseline RAM/VRAM

**DurÃ©e estimÃ©e Session 11** : 8-10 heures (1-2 jours)

---

**Peux-tu m'aider Ã  dÃ©marrer la Phase 1 (Memory Profiling) ?**

Merci de confirmer que tu as bien compris le contexte et nous pouvons commencer ! ğŸš€
